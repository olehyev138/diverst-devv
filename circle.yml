machine:
  timezone:
    America/New_York
  services:
    - elasticsearch
dependencies:
  pre:
    - gem install bundler
  cache_directories:
    - "public/assets"
test:
  pre:
    - bin/rake db:migrate RAILS_ENV=test
    - sudo ln -s /etc/elasticsearch/ /usr/share/elasticsearch/config
    - bundle exec rake assets:precompile assets:clean:
       environment:
        RAILS_GROUPS: assets
deployment:
  production:
    branch: production
    commands:
      - bundle exec cap production deploy
  staging:
    branch: development
    commands:
      - bundle exec cap staging deploy