$(document).on('ready page:load', function()
{
  $('.like-btn').each(function()
  {
    var btn = $(this);

    btn.click(function()
    {
      if (btn.data("isLiked"))
      {
        $.post('/news_feed_likes/unlike',
              { _method: "delete", news_feed_link_id: btn.data("newsFeedLinkId") },
              function(data){ toggleLikeSuccess(data, btn); }
        );
      }
      else
      {
        $.post('/news_feed_likes/',
              { news_feed_link_id: btn.data("newsFeedLinkId") },
              function(data){ toggleLikeSuccess(data, btn); }
        );
      }
    });
  });
});

function toggleLikeSuccess(data, btn)
{
  btn.data("isLiked", data);

  if (btn.data("isLiked"))
  {
    setAsLikedImage(btn);
    incrementLikeCount(btn.data("newsFeedLinkId"));
  }
  else
  {
    setAsUnlikedImage(btn);
    decrementLikeCount(btn.data("newsFeedLinkId"));
  }
}

function setAsLikedImage(btn)
{
  btn.children().attr("src", "<%= image_path("icons/like-active.svg") %>");
}

function setAsUnlikedImage(btn)
{
  btn.children().attr("src", "<%= image_path("icons/like.svg") %>");
}

function incrementLikeCount(news_feed_link_id)
{
  var likeCount = $("#likeCount" + news_feed_link_id)
  likeCount.text(parseInt(likeCount.text()) + 1);
}

function decrementLikeCount(news_feed_link_id)
{
  var likeCount = $("#likeCount" + news_feed_link_id)
  likeCount.text(parseInt(likeCount.text()) - 1);
}