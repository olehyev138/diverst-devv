$(document).on('ready page:load', function()
{
  $('.likeBtn').each(function()
  {
    var btn = $(this);

    btn.click(function()
    {
      if (!btn.data("isLiked"))
      {
        $.post('/likes/',
          { news_feed_link_id: btn.data("newsFeedLinkId") },
          function(data){ likeSuccess(data, btn); }
        );
      }
      else
      {
        $.post('/likes/unlike',
          { _method: "delete", news_feed_link_id: btn.data("newsFeedLinkId") },
          function(data){ unlikeSuccess(data, btn); }
        );
      }
    });
  });
});

function likeSuccess(data, btn)
{
  if (data.like_success === true)
  {
    btn.data("isLiked", true);

    setAsLikedImage(btn);
    incrementLikeCount(btn.data("newsFeedLinkId"));
  }
}

function unlikeSuccess(data, btn)
{
  if (data.unlike_success === true)
  {
    btn.data("isLiked", false);

    setAsUnlikedImage(btn);
    decrementLikeCount(btn.data("newsFeedLinkId"));
  }
}

function toggleLikeSuccess(data, btn)
{
  btn.data("isLiked", data);

  if (btn.data("isLiked"))
  {
    setAsLikedImage(btn);
    incrementLikeCount(btn.data("newsFeedLinkId"));
  }
  else
  {
    setAsUnlikedImage(btn);
    decrementLikeCount(btn.data("newsFeedLinkId"));
  }
}

function setAsLikedImage(btn)
{
  btn.children().attr("src", "<%= image_path("icons/like-active.svg") %>");
}

function setAsUnlikedImage(btn)
{
  btn.children().attr("src", "<%= image_path("icons/like.svg") %>");
}

function incrementLikeCount(news_feed_link_id)
{
  var likeCount = $("#likeCount" + news_feed_link_id)
  likeCount.text(parseInt(likeCount.text()) + 1);
}

function decrementLikeCount(news_feed_link_id)
{
  var likeCount = $("#likeCount" + news_feed_link_id)
  likeCount.text(parseInt(likeCount.text()) - 1);
}