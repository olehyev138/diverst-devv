<div class="card__section card__section--border">
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-2 pull-left">
        <% if !news_link.news_feed_link.is_pinned? %>
          <%= link_to "Pin", pin_group_posts_path(:group_id => news_link.group.id, :link_id => news_link.news_feed_link.id), method: :patch if policy(news_link.group).erg_leader_permissions? %>
        <% else %>
          <%= link_to "Unpin", unpin_group_posts_path(:group_id => news_link.group.id, :link_id => news_link.news_feed_link.id), method: :patch if policy(news_link.group).erg_leader_permissions? %>
        <% end %>
      </div>
      <div class="col-xs-2">
        <% if news_link.photos.count > 0 %>
          <%= render partial: "shared/carousel/template", locals: {news_link: news_link } %>
        <% else %>
          <%= news_link_picture(news_link) %>
        <% end %>
      </div>
      <div class="col-xs-8" id="news_link_<%= news_link.id %>">
        <div class="flex-row flex-row--middle">
          <div class="flex-row__cell flex-row__cell--grow">
            <h4><%= news_link.title %> - <span class="muted"> <%= news_link.total_views %> views</span></h4>
            <p class="postContent">
              <%= raw news_link.description %>
              <% if news_link.url.present? %>
                <p>
                  <%= link_to news_link.url, news_link.url, target: '_blank', 'data-trackable': news_link.news_feed_link.id %>
                </p>
              <% end %>
              <% if news_link.author.present? %>
                <span class="muted">Posted by <%=  news_link.author.name_with_status %></span>
              <% end %>

              <div class="row">
                <div class="col commentsLink">
                  <%= link_to "Comments(#{news_link.comments_count})", comments_group_news_link_path(news_link.group, news_link) %>
                </div>
                <div class="col">
                  <%= render partial: "groups/shared/like_feature", locals: {news_feed_link: news_link.news_feed_link } %>
                </div>
              </div>
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="row visible-xs">
      <div class="col-xs-12">
        <p>
          <%= raw news_link.description %>
          <% if news_link.url.present? %>
            <p>
              <%= link_to news_link.url, news_link.url, target: '_blank', 'data-trackable': news_link.news_feed_link.id %>
            </p>
          <% end %>
          <% if news_link.author.present? %>
            <span class="muted">Posted by <%=  news_link.author.name_with_status %></span>
          <% end %>
          <br>
          <%= link_to "Comments(#{news_link.comments_count})", comments_group_news_link_path(news_link.group,news_link) %>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-8">
        <span class="hidden-xs pull-right">
          <%= link_to "Approve", approve_group_posts_path(:group_id => news_link.group.id, :link_id => news_link.news_feed_link.id), method: :post, class: "btn btn--primary" if policy(news_link.group).erg_leader_permissions? and !news_link.news_feed_link.approved? %>
          
          <% if policy(news_link).edit? %>
            <%= link_to "Edit", edit_group_news_link_path(news_link.group, news_link), class: "btn btn--secondary" %>
          <% end %>
          <%= link_to "Delete", group_news_link_path(news_link.group, news_link), method: :delete, class: "btn btn--danger", data: { confirm: "Are you sure?" } %>
          <% if @group && news_link.news_feed_link.shared_news_feeds.ids.include?(@group.id) && (policy(@group).erg_leader_permissions?) %>
            <%= link_to "Unshare", shared_news_feed_link_path(news_link.news_feed_link.shared_news_feed_links.where(:news_feed_id => @group.news_feed.id).first), method: :delete, class: "btn btn--danger" %>
          <% end %>
        </span>
        <div class="btn-group visible-xs pull-right">
          <%= link_to "Approve", approve_group_posts_path(:group_id => news_link.group.id, :link_id => news_link.news_feed_link.id), method: :post, class: "btn btn-primary" if policy(news_link.group).erg_leader_permissions? and !news_link.news_feed_link.approved? %>
          
          <% if policy(news_link).edit? %>
            <%= link_to "Edit", edit_group_news_link_path(news_link.group, news_link), class: "btn btn-secondary" %>
          <% end %>
          <%= link_to "Delete", group_news_link_path(news_link.group, news_link), method: :delete, class: "btn btn-danger", data: { confirm: "Are you sure?" } if policy(news_link).edit? || policy(news_link.group).erg_leader_permissions? %>
          <% if @group && news_link.news_feed_link.shared_news_feeds.ids.include?(@group.id && (policy(@group).erg_leader_permissions?) || policy(news_link).edit?) %>
            <%= link_to "Unshare", shared_news_feed_link_path(news_link.news_feed_link.shared_news_feed_links.where(:news_feed_id => @group.news_feed.id).first), method: :delete, class: "btn btn--danger" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<%= render "groups/news_links/modal/form" %>

<script>
 $(function() {
   $('a[data-trackable]').on('mousedown', function() {
     $.post('/views/track', { id: $(this).data('trackable') } );
   });
 });
</script>
