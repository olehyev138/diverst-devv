<div class="content__main">
  <div class="card">
    <div class="card__section">
      <%= simple_form_for [@group, @news_link] do |f| %>
        <%= f.input :url, label: "URL", input_html: { autofocus: true } %>
        <%= f.input :title %>
        <%= f.input :description, as: :ckeditor %>

        <!-- <%= f.association :segments, label: "#{c_t(:segment).pluralize}", collection: @group.enterprise.segments, input_html: { class: "select2" } %> -->

        <%= f.simple_fields_for :photos do |p| %>
          <%= render "photo_fields", f: p %>
        <% end %>

        <span><%= link_to_add_association "Add a photo", f, :photos %></span>
        </br>
        </br>

        <%= render partial: "groups/shared/post_sharing", locals: { form: f, group: @group } %>

        <%= f.button :submit %>
      <% end %>
    </div>
  </div>
</div>

<script>
  var $url = $('#news_link_url'),
      $title = $('#news_link_title'),
      $description = $('#news_link_description'),
      timeoutHandle,
      hasTouchedTitleOrDescription = false;

  var autoFillInfo = function() {
    if (!hasTouchedTitleOrDescription) {
      $.get('/groups/news_links/url_info?url=' + $url.val(), function(data) {
        $title.val(data.title);
        $description.val(data.description);
      });
    }
  };

  $($title, $description).focus(function() {
    hasTouchedTitleOrDescription = true;
  });

  $url.keyup(function() {
    timeoutHandle = setTimeout(autoFillInfo, 200);
  });
</script>
