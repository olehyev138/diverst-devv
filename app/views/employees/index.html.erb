<div class="content__header">
  <h1>Employees</h1>
  <div class="flex-row flex-row--middle">
    <div class="flex-row__cell">
      <%= link_to "Export CSV", export_csv_employees_path, class: "btn btn--secondary" %>
    </div>
    <div class="flex-row__cell">
      <%= link_to "Import CSV", import_csv_employees_path, class: "btn btn--secondary" %>
    </div>
    <div class="flex-row__cell">
      <%= link_to "Add an employee", new_employee_invitation_path, class: "btn btn--primary" %>
    </div>
  </div>
</div>

<div class="content__main">
  <h3>Invitations sent</h3>
  <div class="card">
    <div class="card__section">
      <% if @employees.invitation_not_accepted.any? %>
        <table class="table--has-border" id="invited-employees-table">
          <thead>
            <th>Email</th>
            <th></th>
          </thead>
          <tbody>
            <% @employees.invitation_not_accepted.each do |employee| %>
              <tr>
                <td><%= link_to employee.email, employee_path(employee) %></td>
                <td class="text-right"><%= link_to "Revoke invitation", employee_path(employee), method: :delete, class: "error" %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p>No invitation is currently awaiting response. Employees you <%= link_to "manually invite", new_employee_invitation_path %> will be shown here until they accept their invitation.</p>
      <% end %>
    </div>
  </div>

  <h3>Manually added</h3>
  <div class="card">
    <div class="card__section">
      <table class="table--has-border" id="employees-table" data-source="<%= employees_path(format: :json) %>">
        <thead>
          <th>First name</th>
          <th>Last name</th>
          <th>Email</th>
          <th>Options</th>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <h3>SAML</h3>
  <div class="card">
    <div class="card__section">
      <% if @employees.where(auth_source: "saml").any? %>
        <table class="table--has-border">
          <thead>
            <th>Name</th>
            <th>Email</th>
            <th>Options</th>
          </thead>
          <tbody>
            <% @employees.where(auth_source: "saml").each do |employee| %>
              <tr>
                <td><%= employee.name %></td>
                <td><%= employee.email %></td>
                <td>
                  <%= link_to "Details", employee_path(employee) %>
                  <%= link_to "Delete", employee_path(employee), method: :delete, class: "error" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p>No employee has signed in through SAML yet. When they do, they will show up here. If you can't sign in through SAML, try <%= link_to "setting it up", edit_auth_enterprise_path(current_admin.enterprise) %> from the global settings.</p>
      <% end %>
    </div>
    <% if @employees.where(auth_source: "saml").any? %>
      <div class="card__section">
        <%= paginate @employees %>
      </div>
    <% end %>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('#employees-table').dataTable(Utility.mergeWithDTDefaults({
      serverSide: true,
      ajax: $('#employees-table').data('source')
    }));

    $('#invited-employees-table').dataTable(Utility.defaultDatatablesOptions);
  });
</script>