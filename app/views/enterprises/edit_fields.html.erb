<div class="content__header">
  <h1>User fields</h1>
</div>

<div class="row">
  <div class="col sm-12">
    <%= simple_form_for @enterprise, :url => enterprise_path(@enterprise, source: 'edit_fields') do |f| %>
      <%= render "shared/fields/creation/custom_fields", f: f %>
      <%= f.button :submit, value: "Save user fields" %>
    <% end %>
  </div>
</div>

<script>
  var handleNewField = function($fieldEl) {
    $fieldEl.find('.expand-link').click(function() {
      $fieldEl.find('.card__content').toggleClass('card__content--is-visible');
      $(this).text($(this).text() === "Edit" ? "Close" : "Edit");
    });
  };

  $('.nested-fields').each(function() {
    handleNewField($(this));
  });

  $('#fields').on('cocoon:after-insert', function(e, insertedItem) {
    handleNewField(insertedItem);
    insertedItem.find('.expand-link').click(); // Expand newly added fields
  });
</script>