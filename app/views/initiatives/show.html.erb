<div class="content__header">
  <h1><%= @initiative.name %></h1>
</div>

<div class="content__main">
  <div class="card">
    <div class="card__section">
      <h3>Metrics</h3>
      <table class="table--has-border" id="updates-table">
        <thead>
          <th>Metric</th>
          <% @updates.each_with_index do |update, index| %>
            <th>
              <% if index == @updates.size - 1 %>
                Last update
              <% else %>
                <%= pluralize(@updates.size - index - 1, 'update') %> ago
              <% end %>
              (<%= update.created_at.to_s :reversed_slashes %>)
            </th>
          <% end %>
        </thead>
        <tbody>
          <% @initiative.fields.each do |field| %>
            <tr>
              <td><%= field.title %></td>
              <% @updates.each do |update| %>
                <td><%= field.string_value update.info[field] %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <div class="card__section">
      <h3>Graphs</h3>
      <% @initiative.fields.each do |field| %>
        <div class="graph" style="width: 49%; display: inline-block;" data-title="<%= field.title %>"></div>
      <% end %>
    </div>
  </div>
</div>

<script>
  $('.graph').each(function() {
    var lastValue = 100;
    $(this).highcharts({
      title: {
        text: $(this).data('title')
      },
      xAxis: {
        categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
      },
      yAxis: {
        title: {
          text: 'Nb of participants'
        }
      },
      tooltip: {
        valueSuffix: ' employees'
      },
      series: [{
        name: 'Employee count',
        data: Array.apply(null, Array(12)).map(function() {
          var nextValue = lastValue + Math.random() * 100
          lastValue = nextValue;
          return Math.round(nextValue);
        })
      }]
    });
  });
</script>